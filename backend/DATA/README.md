# 📂 DATA 폴더 (전처리 규칙)

## 1. 전체 구조 정리
- **원본 JSON 구조**
  - `법령` 키 아래에 `조문`, `부칙`, `별표`, `개정문`, `제개정이유` 등 다양한 메타데이터 존재
- **목표**
  - 최종적으로는 **조문만 남김**
  - `부칙`과 `별표`는 임베딩 대상에서 제외 (필요 시 `Tool Calling`으로 가져오기)

---

## 2. 조문 내 불필요한 키 제거
### ✅ 삭제 대상
`조문변경여부`
`조문이동이전`
`조문이동이후`
`호번호`
`목번호`

### ✅ 유지 대상
`조문번호`
 `조문제목`
 `조문내용`
 `항번호`
 `항내용`
 `호내용`
 `목내용`

---

## 3. 텍스트 정규화
- **항번호 변환**
  - ①②③ 같은 원형 숫자 → 아라비아 숫자 (1, 2, 3 …)
  ```
  <!-- before -->
    "항": [
            {
                "항번호": "①",
                "항내용": "① 사업주는 인체에 해로운 물질, 부패하기 쉬운 물질 또는 악취가 나는 물질 등에 의하여 오염될 우려가 있는 작업장의 바닥이나 벽을 수시로 세척하고 소독하여야 한다."
            },
            {
                "항번호": "②",
                "항내용": "② 사업주는 제1항에 따른 세척 및 소독을 하는 경우에 물이나 그 밖의 액체를 다량으로 사용함으로써 습기가 찰 우려가 있는 작업장의 바닥이나 벽은 불침투성(不浸透性) 재료로 칠하고 배수(排水)에 편리한 구조로 하여야 한다."
            }
         ]

    <!-- after -->
    "항": [
            {
              "항내용": "1 사업주는 인체에 해로운 물질, 부패하기 쉬운 물질 또는 악취가 나는 물질 등에 의하여 오염될 우려가 있는 작업장의 바닥이나 벽을 수시로 세척하고 소독하여야 한다."
            },
            {
              "항내용": "2 사업주는 제1항에 따른 세척 및 소독을 하는 경우에 물이나 그 밖의 액체를 다량으로 사용함으로써 습기가 찰 우려가 있는 작업장의 바닥이나 벽은 불침투성(不浸透性) 재료로 칠하고 배수(排水)에 편리한 구조로 하여야 한다."
            }
          ]
  ```
- **앞뒤 공백 제거**
  - `strip()` 적용
- **백슬래시(`\`) 처리 ?**
```
"1.  \"중대재해\"란 \"중대산업재해\"와 \"중대시민재해\"를 말한다."
```
  - JSON dump/load 과정에서 보이는 `\"`는 escape일 뿐 실제 텍스트에는 없음
  - 따라서 `text.replace("\\", "")`는 필요없음 → **백슬래시는 건드리지 않음**

---

## 4. 전문(全文) 처리
- `조문여부` 필드가 `"전문"`인 경우 → 장/절 제목  
  - **임베딩 제외** <br> 전문에는 상위 분류개념만 들어있고 내용은 없으며 조문은 숫자로 구분되기 때문에
  ```
        {
            "조문번호": "1",
            "조문시행일자": "20250901",
            "조문변경여부": "N",
            "조문이동이전": "",
            "조문키": "0001000",
            "조문내용": "          제1편 총칙",
            "조문이동이후": "",
            "조문여부": "전문"
        },
        {
            "조문번호": "1",
            "조문시행일자": "20250901",
            "조문변경여부": "N",
            "조문이동이전": "",
            "조문키": "0001000",
            "조문내용": "            제1장 통칙",
            "조문이동이후": "",
            "조문여부": "전문"
        },
  ```
  - 필요하다면 UI에서 트리 구조 표시용 메타데이터로만 사용
- `조문여부` 필드가 `"조문"`인 경우 → 실제 조문 텍스트  
  - **임베딩 포함**

---

## 5. 임베딩 단위 (chunking.py)
- '제37조부터 제40조까지' → '제37조, 제38조, 제39조, 제40조'
-  "조문 JSON(dict) → 합쳐진 텍스트(str) 변환"


- **항이 없는 조문**
  - `조문내용`만 하나의 chunk
- **항이 있는 조문**
  - `조문내용`은 별도 chunk
  - 각 `항내용`은 개별 chunk
  - 필요 시 `호내용`, `목내용`도 별도 chunk로 분리 가능
-  **임베딩 텍스트를 만들때 줄바꿈 기호 넣어야하나 ??**
    - GPT 임베딩 모델은 줄바꿈을 의미 단위 구분으로 잘 처리하기 때문에 유지하는게 맞음

### 결과
```
{
    "조문번호": "1",
    "조문시행일자": "20250901",
    "조문키": "0001001",
    "조문내용": "제1조(목적) 이 규칙은「산업안전보건법」제5조, 제16조, 제37조부터 제40조까지,
    제63조부터 제66조까지, 제76조부터 제78조까지, 제80조, 제81조, 제83조, 제84조, 제89조, 
    제93조, 제117조부터 제119조까지 및 제123조 등에서 위임한 산업안전보건기준에 관한 사항과 그 
    시행에 필요한 사항을 규정함을 목적으로 한다. <개정 2012.3.5, 2019.12.26>",

    "조문제목": "목적",
    "조문여부": "조문",
    "embedding_text": "제1조(목적) 이 규칙은「산업안전보건법」제5조, 제16조, 제37조, 제38조,
    제39조, 제40조, 제63조, 제64조, 제65조, 제66조, 제76조, 제77조, 제78조, 제80조, 제81조,
    제83조, 제84조, 제89조, 제93조, 제117조, 제118조, 제119조 및 제123조 등에서 위임한 
    산업안전보건기준에 관한 사항과 그 시행에 필요한 사항을 규정함을 목적으로 한다. 
    <개정 2012.3.5, 2019.12.26>"
},
```
- <개정 2012.3.5, 2019.12.26> 이부분 모델이 이해하기 힘들수 있음
   ```
   "amendments": [
            {
              "type": "개정",
              "date": "2020.9.8"
            },
            {
              "type": "개정",
              "date": "2022.8.16"
            }
          ],
    ```
이런식으로 메타데이터로 추가

---

## ✅ 요약
- **조문만 남기고 임베딩**
- **불필요 키 삭제 + 항번호 숫자 정규화**
- **전문은 임베딩 제외 (원하면 메타로 보존)**
- **chunking은 Adaptive Chunking** <br> 조단위 chunk 가 기본 그러나 토큰수가 많으면 항단위 -> 많으면 호로, 목으로 ... 쪼개서 저장

---
## 참고
항, 호, 목 전부 숫자 1. 2. 3. 이런식이라 모델이 분리 못할것이 우려됨 <br>
[ ] 괄호 붙이는 게 좋은가?<Br>
장점: 텍스트에서 확실하게 태그처럼 눈에 띄어서 계층 구분이 명확해짐 → 모델이 구조를 더 잘 이해할 수 있음<br>
예: [제1항], [제2호]


